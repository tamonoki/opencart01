tinymce.PluginManager.add('soycms_emoji', function(editor, url) {

	var emoticons = [
		[257,258,259,260,264,51,265,266,272,273,261,263,270,262,283,282,281,287,271,284,77,267,76,75,69,15,47,227,269,268,286,277,274,236,68,163,80,50,124,83,301,295,297,72,144,52,12,65,93,225,146,240,160,245,239,275,244,243,241,238,242,252,247,254,250,249,134,251,78,248,253,246,74,276,192,193,194,195,196,197,198,199,204,200,201,202,203,113,53,235,255,256,133,60,234,44,107,95,167,16,190,191,215,125,216,148,169,172,217,168,302,206,205,212,207,208,209,99,98,179,178,141,140,1,176,177,2,3,224,211,112,156,228,278,280,303,86,279,285,229,230,231,48,232,170,223,45,219,96,220,221,222,218,288,210,110,94,289,291,300,294,13,292,293,237,46,58,104,304,226,296,119,120,138,233,290,106,116,165,149,91,122,145,158,129,143,108,166,161,85,180,181,182,183,184,185,186,187,188,325,348,349,442,446,454,455,456,814,786,789,350,440,450,451,452,351,441,443,444,445,447,448,449,779,791,459,460,461,462,463,464,465,466,783,787,782,792,813,785,788,780,790,820,819,821,822,415,416,417,418,419,328,803,770,343,735,757,758,777,778],
		[329,801,330,420,731,732,733,734,317,457,318,458,817,319,320,390,391,513,784,799,815,806,151,332,214,354,364,392,356,404,405,312,728,414,314,315,316,344,434,776,435,736,737,738,739,743,742,436,437,740,744,741,425,760,772,483,748,763,764,765,762,761,313,775,426,428,427,423,429,424,333,431,430,745,798,438,432,439,433,746,401,400,372,804,721,347,722,766,767,768,718,756,719,723,345,346,717,749,720,365,715,352,713,716,773,774,812,339,397,759,398,811,816,399,358,479,480,485,781,747,357,484,486,361,488,487,489,476,477,478,371,490,491,493,810,342,769,374,467,355,468,482,708,709,710,711,712,754,755,794,800,335,336,359,396,407,408,409,410,411,412,413,481,729,793,805,306,307,471,421,751,752,470,753,714,369,453,750,469,796,797,362,373,337,395,771,403,126,115,309,341,353,379,472,473,474,475,213,795,375,376,377,378,492,495,340,360,496,497,90,499,700,701,702,703,704,363,368,370,402,380,334,382,383,386,387,388,389,29,30,64,63,70,42,43,71,808,809,807,422,61,381,393,394,802,406,331]
	];

	function getHtml() {
		var emoticonsHtml;

		emoticonsHtml = '<table role="presentation" class="mce-grid">';

		tinymce.each(emoticons, function(row) {
			emoticonsHtml += '<tr>';

			tinymce.each(row, function(icon) {
				var emoticonUrl = url + '/img/' + icon + '.gif';

				emoticonsHtml += '<td><a href="#" data-mce-url="' + emoticonUrl + '" tabindex="-1"><img src="' +
					emoticonUrl + '" style="width: 18px; height: 18px"></a></td>';
			});

			emoticonsHtml += '</tr>';
		});

		emoticonsHtml += '</table>';

		return emoticonsHtml;
	}

	editor.addButton('soycms_emoji', {
		type: 'panelbutton',
		popoverAlign: 'bc-tl',
		panel: {
			autohide: true,
			html: getHtml,
			onclick: function(e) {
				var linkElm = editor.dom.getParent(e.target, 'a');

				if (linkElm) {
					editor.insertContent('<img src="' + linkElm.getAttribute('data-mce-url') + '" />');
					this.hide();
				}
			}
		},
		tooltip: '絵文字を挿入',
		image : url + '/img/icon.gif'
	});
/*
	editor.addButton('emoticons', {
		type: 'panelbutton',
		popoverAlign: 'bc-tl',
		panel: {
			layout: 'flex',
			spacing: 5,
			padding: 5,
			autohide: true,
			items: [
				{type: 'textbox', label: 'Url'},
				{type: 'button', text: 'OK'}
			]
		},
		tooltip: 'Emoticons'
	});*/
});
